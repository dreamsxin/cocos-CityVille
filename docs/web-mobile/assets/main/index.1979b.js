window.__require=function e(i,t,a){function n(s,c){if(!t[s]){if(!i[s]){var l=s.split("/");if(l=l[l.length-1],!i[l]){var r="function"==typeof __require&&__require;if(!c&&r)return r(l,!0);if(o)return o(l,!0);throw new Error("Cannot find module '"+s+"'")}s=l}var d=t[s]={exports:{}};i[s][0].call(d.exports,function(e){return n(i[s][1][e]||e)},d,d.exports,e,i,t,a)}return t[s].exports}for(var o="function"==typeof __require&&__require,s=0;s<a.length;s++)n(a[s]);return n}({AudioManager:[function(e,i,t){"use strict";cc._RF.push(i,"5f1e8ds0wBGCIRQBCfFfqcl","AudioManager");t={instance:null};var a=cc.Class({name:"Sound",properties:{name:"",clips:{type:[cc.AudioClip],default:[]},duration:3}});cc.Class({extends:cc.Component,properties:{sfx:{type:[a],default:[]},masterVolume:{type:cc.Float,default:1},backgroundMusic:{type:cc.AudioClip,default:null},environmentMusic:{type:cc.AudioClip,default:null},voiceOver:{type:cc.AudioClip,default:null},_backgroundMusicId:{default:null},_environmentMusicId:{default:null},_voiceOverId:{default:null},_currentSoundId:{default:null},_audioModules:{default:[]}},isPlaying:function(e){},getSoundByName:function(e){return this.sfx.find(function(i){return i.name===e})},playSfx:function(e,i,t){void 0===t&&(t=!1);var a=this.getSoundByName(e).clips;if(0==a.length||null===a||void 0===a)return console.error("No sound found by name or clips list is empty for",e),-1;var n=Math.floor(Math.random()*a.length),o=cc.audioEngine.playEffect(a[n],t);return cc.audioEngine.setFinishCallback(o,function(){if(i)return i()}),o},getSfxDuration:function(e){return this.getSoundByName(e).duration},stopSfx:function(e){cc.audioEngine.stopEffect(e)},stopAllSfx:function(){for(var e=0;e<this._audioModules.length;e++)this._audioModules.pop().stopAll()},toggleSound:function(){0===this.masterVolume?this.masterVolume=1:this.masterVolume=0,cc.audioEngine.setEffectsVolume(this.masterVolume)},playVoiceOver:function(e){var i=this;if(this.voiceOver)this._voiceOverId=cc.audioEngine.playEffect(this.voiceOver,!1),cc.audioEngine.setFinishCallback(this._voiceOverId,function(){if(i.playMusic(),e)return e()});else if(this._voiceOverId=-1,this.playMusic(),e)return e()},playMusic:function(){cc.audioEngine.setEffectsVolume(this.masterVolume),this.backgroundMusic&&(this._backgroundMusicId=cc.audioEngine.playEffect(this.backgroundMusic,!0)),this.environmentMusic&&(this._environmentMusicId=cc.audioEngine.playEffect(this.environmentMusic,!0))},onLoad:function(){t.instance=this}}),i.exports=t,cc._RF.pop()},{}],AudioModule:[function(e,i,t){"use strict";cc._RF.push(i,"5f2e0+Jy9NPlbbXyxGJL5E1","AudioModule");var a=e("AudioManager");cc.Class({properties:{audioReferences:{default:{}}},__ctor__:function(){this._previousClip=null,this._isPlaying=!1,a.instance._audioModules.push(this)},playSfx:function(e,i,t){var n=this;void 0===t&&(t=!1);var o=a.instance.getSoundByName(e);if(null!==o&&void 0!==o){null!==this.audioReferences[e]&&void 0!==this.audioReferences[e]||(this.audioReferences[e]=[]);var s=a.instance.playSfx(e,function(){i&&i(),delete n.audioReferences[e]},t);this.audioReferences[e].push(s)}},playSfxOnly:function(e,i,t){var n=this;void 0===t&&(t=!1);var o=a.instance.getSoundByName(e);if(null!==o&&void 0!==o){null!==this.audioReferences[e]&&void 0!==this.audioReferences[e]||(this.audioReferences[e]=[]),this._previousClip&&this.audioReferences[this._previousClip]>0&&this.stopSfx(this._previousClip),this._previousClip&&this.stopSfx(this._previousClip),this._previousClip=e;var s=a.instance.playSfx(e,function(){i&&i(),delete n.audioReferences[e]},t);s&&this.audioReferences[e]&&this.audioReferences[e].push(s)}},getSfxDuration:function(e){return a.instance.getSfxDuration(e)},stopSfx:function(e){var i=this.audioReferences[e];if(null!==i&&void 0!==i){for(var t=0;t<i.length;t++)a.instance.stopSfx(i[t]);delete this.audioReferences[e]}},stopAllSfx:function(){Object.keys(this.audioReferences).forEach(function(e){this.stopSfx(this.audioReferences[e])})}}),cc._RF.pop()},{AudioManager:"AudioManager"}],InputManager:[function(e,i,t){"use strict";cc._RF.push(i,"c9bceL9k59FSqlKi4jjAVs4","InputManager");var a=e("./TileMapManager");cc.Class({extends:cc.Component,properties:{objectLayer:{type:cc.TiledObjectGroup,default:null},camNode:{type:cc.Node,default:null},touchNode:{type:cc.Node,default:null},tiledMapManager:{type:a,default:null},selectedItem:{type:cc.Node,default:null}},getLayerWidth:function(){return this.tiledMapManager.tiledLayer.getMapTileSize().width},getLayerHeight:function(){return this.tiledMapManager.tiledLayer.getMapTileSize().height},addInvalidTile:function(e){if(this.tiledMapManager.checkValidPos(e)){var i=this.tiledMapManager.getMappedTile(e);this.tiledMapManager._invalidTiles.push(i)}},removeInvalidTile:function(e){if(this.tiledMapManager.checkValidPos(e)){var i=this.tiledMapManager.getMappedTile(e);if(i)for(var t=0;t<this.tiledMapManager._invalidTiles.length;t++)if(this.tiledMapManager._invalidTiles[t]==i){this.tiledMapManager._invalidTiles.splice(t,1);break}}},onKeyUp:function(e){},createObjects:function(e){this.objects=e.getObjects();this.objects&&this.objects.forEach(function(e){})},checkValidMovePos:function(e){var i=this,t=this.selectedItem.getComponent("Item").x,a=this.selectedItem.getComponent("Item").y,n=this.tiledMapManager.tiledLayer.getMapTileSize().width,o=this.tiledMapManager.tiledLayer.getMapTileSize().height,s=e,c=!0,l=[],r=cc.v2(s.x,s.y);if(this.tiledMapManager.checkValidPos(r)&&this.tiledMapManager.checkValidWalkablePos(r)){var d=this.tiledMapManager.GetMapPosition(this.tiledMapManager.tiledLayer,r);(h=this.tiledMapManager.tiledLayer.getTiledTileAt(d.x,d.y,!0)).node;l.push(h)}if(this.tiledMapManager.checkValidWalkablePos(e)){for(var u=1;u<t;u++)if(r=cc.v2(s.x-t*n,s.y),this.tiledMapManager.checkValidPos(r)&&this.tiledMapManager.checkValidWalkablePos(r)){d=this.tiledMapManager.GetMapPosition(this.tiledMapManager.tiledLayer,r),(h=this.tiledMapManager.tiledLayer.getTiledTileAt(d.x,d.y,!0)).node;l.push(h)}else c=!1;for(u=1;u<a;u++)if(r=cc.v2(s.x,s.y-a*o),this.tiledMapManager.checkValidPos(r)&&this.tiledMapManager.checkValidWalkablePos(r)){var h;d=this.tiledMapManager.GetMapPosition(this.tiledMapManager.tiledLayer,r),(h=this.tiledMapManager.tiledLayer.getTiledTileAt(d.x,d.y,!0)).node;l.push(h)}else c=!1;if(0==c)return;cc.instantiate(this.selectedItem).parent=this.selectedItem.parent,s=this.tiledMapManager.GetMapPosition(this.tiledMapManager.tiledLayer,e);var p=this.tiledMapManager.tiledLayer.node.convertToNodeSpaceAR(this.tiledMapManager.tiledLayer.getPositionAt(s.x,s.y));this.selectedItem.setPosition(cc.v2(p.x+170,p.y+192)),l.forEach(function(e){i.tiledMapManager._invalidTiles.push(e)})}},HoverEvent:function(e){var i=this.tiledMapManager.node.getComponent(cc.TiledMap),t=(i.getMapSize().height,i.getMapSize().width,e.getLocation());t.x+=this.camNode.position.x,t.y+=this.camNode.position.y;var a=this.tiledMapManager.tiledLayer.node.convertToNodeSpaceAR(t);if(this.tiledMapManager.checkValidWalkablePos(a)){a=this.tiledMapManager.GetMapPosition(this.tiledMapManager.tiledLayer,a);var n=this.tiledMapManager.tiledLayer.getTiledTileAt(a.x,a.y,!0).node,o=this.tiledMapManager.tiledLayer.node.convertToNodeSpaceAR(this.tiledMapManager.tiledLayer.getPositionAt(a.x,a.y));this.selectedItem.setPosition(cc.v2(o.x+100,o.y+170));n.addComponent(cc.Sprite);n.color=cc.Color.YELLOW,this.node.runAction(cc.sequence(cc.delayTime(.5),cc.callFunc(function(){n.color=cc.Color.WHITE})))}},HandleClickEvent:function(e){if(this.selectedItem){var i=this.tiledMapManager.node.getComponent(cc.TiledMap),t=(i.getMapSize().height,i.getMapSize().width,e.getLocation());t.x+=this.camNode.position.x,t.y+=this.camNode.position.y;var a=this.tiledMapManager.tiledLayer.node.convertToNodeSpaceAR(t);this.tiledMapManager.checkValidPos(a)&&this.tiledMapManager.checkValidWalkablePos(a)&&this.checkValidMovePos(a)}},onLoad:function(){this.node;this.touchNode.on(cc.Node.EventType.TOUCH_START,this.HandleClickEvent,this),this.touchNode.on(cc.Node.EventType.MOUSE_DOWN,this.HandleClickEvent,this),this.touchNode.on(cc.Node.EventType.MOUSE_WHEEL,this.moveY,this,!0),this.touchNode.on(cc.Node.EventType.MOUSE_MOVE,this.moveX,this,!0),cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN,this.onKeyDown,this),cc.systemEvent.on(cc.SystemEvent.EventType.KEY_UP,this.onKeyUp,this),t.instance=this;var e=cc.director.getCollisionManager();cc.director.getPhysicsManager().enabled=!0,e.enabled=!0,this.createObjects(this.objectLayer),this.deltaY=0},moveY:function(e){this.deltaY=e.getScrollY(),this.camNode.setPosition(this.camNode.getPosition().x,this.camNode.getPosition().y+this.deltaY/10)},moveX:function(e){this.HoverEvent(e),this.deltaX||(this.deltaX=e.getLocationX());var i=e.getLocationX()-this.deltaX;i+=1*Math.sign(i),this.camNode.setPosition(this.camNode.getPosition().x+i,this.camNode.getPosition().y),this.deltaX=e.getLocationX()}}),cc._RF.pop()},{"./TileMapManager":"TileMapManager"}],Item:[function(e,i,t){"use strict";cc._RF.push(i,"10650hz0j1ILq1vuQeq+SoT","Item"),cc.Class({extends:cc.Component,properties:{x:{type:cc.Integer,default:1},y:{type:cc.Integer,default:1}}}),cc._RF.pop()},{}],Screen:[function(e,i,t){"use strict";cc._RF.push(i,"1d0d23hJDxAjp/yoXwsx2e4","Screen"),cc.Class({extends:cc.Component,onLoad:function(){this.canvas=this.node.getComponent(cc.Canvas),Screen.canvasNode=this.node,this.resizeCanvas(),cc.view.resizeWithBrowserSize(!0),cc.view.setResizeCallback(this.resizeCanvas.bind(this))},resizeCanvas:function(){},statics:{canvasNode:0,getCanvasPosition:function(e){var i=e.parent.convertToWorldSpaceAR(e.getPosition());return Screen.canvasNode.convertToNodeSpaceAR(i)}}}),cc._RF.pop()},{}],TileMapManager:[function(e,i,t){"use strict";cc._RF.push(i,"c51dbwZNXVIFqsGLqr/uG7n","TileMapManager"),cc.Class({extends:cc.Component,properties:{canvasNode:{type:cc.Node,default:null},tiledMap:{type:cc.TiledMap,default:null},tiledLayer:{type:cc.TiledLayer,default:null},_invalidTiles:{default:[]}},onLoad:function(){this._mode="walk",this._invalidTiles=[]},getMappedTile:function(e){this.tiledLayer.node.convertToNodeSpaceAR(e);return e=this.GetMapPosition(this.tiledLayer,e),this.tiledLayer._isInvalidPosition(e.x,e.y)?null:this.tiledLayer.getTiledTileAt(e.x,e.y,!0)},checkValidPos:function(e){this.tiledLayer.node.convertToNodeSpaceAR(e);if(e=this.GetMapPosition(this.tiledLayer,e),this.tiledLayer._isInvalidPosition(e.x,e.y))return!1;var i=this.tiledLayer.getTiledTileAt(e.x,e.y,!0),t=this.tiledMap.getPropertiesForGID(i.gid);return!!t&&0!=t.isWalkable},checkValidWalkablePos:function(e){this.tiledLayer.node.convertToNodeSpaceAR(e);if(e=this.GetMapPosition(this.tiledLayer,e),this.tiledLayer._isInvalidPosition(e.x,e.y))return!1;var i=this.tiledLayer.getTiledTileAt(e.x,e.y,!0);if(i)for(var t=0;t<this._invalidTiles.length;t++)if(this._invalidTiles[t]==i)return!1;var a=this.tiledMap.getPropertiesForGID(i.gid);return!!a&&0!=a.isWalkable},GetMapPosition:function(e,i){var t=e.getMapTileSize().width,a=e.getMapTileSize().height,n=e.getLayerSize().width,o=e.getLayerSize().height,s=i.x/t,c=i.y/a,l=n/2,r=Math.floor(o-c+s-l),d=Math.floor(o-c-s+l);return new cc.Vec2(r,d)},MapIndexToNodePosition:function(e,i,t,a){return e.getPositionAt(i,t-1)},GetWalkableMatrixMapFromLayer:function(e,i,t,a){var n=e.getTileSets();console.log(n);var o=n,s=[];e.getProperties();e.width=i,e.height=t;for(var c=0;c<i;c++){for(var l=[],r=0;r<t;r++){e._positionForIsoAt(c,r);var d=c*t+r;if(d<o.length){var u=this.tiledMap.getPropertiesForGID(o[d]);if(u)if(1==u.isWalkable){var h=this.MapIndexToNodePosition(e,c,r,this.node);if(this.getMappedTile(h)){for(var p=!1,f=0;f<this._invalidTiles.length;f++)if(this._invalidTiles[f].x==r&&this._invalidTiles[f].y==c){p=!0;break}p?l.push(1):l.push(0)}else l.push(0)}else l.push(1);else l.push(1)}}s.push(l)}return s},ResolveGridPathToPositions:function(e,i,t){if(null!=t){for(var a=[],n=null,o=null,s=1;s<i.length;s++){var c=i[s][0],l=i[s][1];if(n!=c&&o!=l){n=i[s-1][0],o=i[s-1][1];var r=this.MapIndexToNodePosition(e,n,o,t.node);a.push(r)}if(s==i.length-1){r=this.MapIndexToNodePosition(e,i[s][0],i[s][1],t.node);a.push(r)}}return a}}}),cc._RF.pop()},{}]},{},["AudioManager","AudioModule","InputManager","Item","Screen","TileMapManager"]);